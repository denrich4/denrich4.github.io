
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Audio Visualizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #1a1a1a;
            color: #fff;
        }
        svg {
            display: block;
            margin: 20px auto;
            background-color: #000;
        }
        .controls {
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>SVG Audio Visualizer</h1>
    <div class="controls">
        <input type="file" id="audioFile" accept="audio/*">
        <br><br>
        <audio id="audioPlayer" controls></audio>
        <br><br>
        <label for="shapeSelect">Choose Shape:</label>
        <select id="shapeSelect">
            <option value="circle">Circle</option>
            <option value="heart">Heart</option>
            <option value="crescent">Crescent Moon</option>
            <option value="waning">Waning Moon</option>
        </select>
    </div>

    <svg id="svgVisualizer" width="800" height="800" viewBox="0 0 100 100">
        <circle id="circle" cx="50" cy="50" r="25" fill="hsl(200, 100%, 50%)" />
        <path id="heart" d="M50,30 C60,20 70,20 75,30 80,40 70,50 50,70 30,50 20,40 25,30 30,20 40,20 50,30" fill="hsl(200, 100%, 50%)" style="display:none;" />
        
        <path id="crescent" d="M36.5,11.2c0-6.4,5.2-11.4,11.4-11.4c6.4,0,11.4,5.2,11.4,11.4c0,6.4-5.2,11.4-11.4,11.4S36.5,17.4,36.5,11.2z M54.1,24.9
	c-2.9-1.6-6.6-0.5-8.2,2.4l-3.2,5.8c-0.4-3-1.2-5.8-1.9-7c-1.6-3.3-3.7-4.6-3.7-4.6c-11.2-6.4-17.2,5.4-17.3,5.8
	c-1.1,2.6-2.6,6.9-2.5,15.3c0.4,19.2,11.5,45.1,11.5,45.1H7.3C3.4,87.7,0,90,0,94.2c0,3.7,3.2,6,7,6h29.9c4.5,0,7.9-2.5,8.1-11
	l0.3-35.5l11.4-20.8C58.1,30,57,26.4,54.1,24.9z" fill="hsl(200, 100%, 50%)" style="display:none;" />
        
       
        <path id="waning" d="M294,377.125 C315.6666666666667,392.125,337.3333333333333,407.125,359,422.125 L368,431.125
M795.6983032226562,266.8365173339844
M936.2740478515625,8.745819091796875
M1137.3206787109375,52.31779479980469 C1134.97021484375,53.55488077799479,1132.6197509765625,54.7919667561849,1130.269287109375,56.029052734375 Q1128.7847900390625,58.07025146484375,1127.30029296875,60.1114501953125 C1126.5580240885417,63.94642130533854,1125.8157552083333,67.78139241536458,1125.073486328125,71.61636352539062 Q1125.6301879882812,74.95650482177734,1126.1868896484375,78.29664611816406 Q1127.3002319335938,79.96671295166016,1128.41357421875,81.63677978515625 Q1131.011474609375,82.93572235107422,1133.609375,84.23466491699219 C1137.1969401041667,84.48208109537761,1140.7845052083333,84.72949727376302,1144.3720703125,84.97691345214844 Q1147.155517578125,84.23465728759766,1149.93896484375,83.49240112304688 C1152.4131266276042,80.77080790201823,1154.8872884114583,78.04921468098958,1157.3614501953125,75.32762145996094 Q1158.1036987304688,72.35861206054688,1158.845947265625,69.38960266113281 Q1158.660400390625,64.93608856201172,1158.474853515625,60.482574462890625 Q1156.4336547851562,57.88468933105469,1154.3924560546875,55.28680419921875 Q1151.6090087890625,53.98786163330078,1148.8255615234375,52.68891906738281 L1136.207275390625,53.43116760253906
M1063.0953369140625,50.15374755859375 C1072.2497965494792,51.761962890625,1081.4042561848958,53.37017822265625,1090.5587158203125,54.9783935546875 C1093.8988444010417,56.46290079752604,1097.2389729817708,57.947408040364586,1100.5791015625,59.431915283203125 C1103.6718343098958,62.15350850423177,1106.7645670572917,64.87510172526042,1109.8572998046875,67.59669494628906 C1112.3314615885417,71.06054178873698,1114.8056233723958,74.52438863118489,1117.27978515625,77.98823547363281 C1118.5168863932292,80.46241251627605,1119.7539876302083,82.93658955891927,1120.9910888671875,85.4107666015625 C1121.7333170572917,88.87461344401042,1122.4755452473958,92.33846028645833,1123.2177734375,95.80230712890625 C1123.4652099609375,101.61661783854167,1123.712646484375,107.43092854817708,1123.9600830078125,113.2452392578125 Q1123.2178344726562,117.14205932617188,1122.4755859375,121.03887939453125 C1120.74365234375,124.62644449869792,1119.01171875,128.2140096028646,1117.27978515625,131.80157470703125 C1111.8365885416667,137.36846923828125,1106.3933919270833,142.93536376953125,1100.9501953125,148.50225830078125 C1095.38330078125,150.4815877278646,1089.81640625,152.4609171549479,1084.24951171875,154.44024658203125 C1077.3218587239583,154.44024658203125,1070.3942057291667,154.44024658203125,1063.466552734375,154.44024658203125 C1071.7550455729167,149.12076822916666,1080.0435384114583,143.8012898763021,1088.33203125,138.4818115234375 C1091.7958577473958,134.52313232421875,1095.2596842447917,130.564453125,1098.7235107421875,126.60577392578125 C1100.2080078125,123.14192708333333,1101.6925048828125,119.67808024088542,1103.177001953125,116.2142333984375 C1103.7955729166667,112.75038655598958,1104.4141438802083,109.28653971354167,1105.03271484375,105.82269287109375 C1104.2904459635417,99.6372578938802,1103.5481770833333,93.45182291666667,1102.805908203125,87.26638793945312 C1101.6925455729167,84.17367045084636,1100.5791829427083,81.08095296223958,1099.4658203125,77.98823547363281 C1095.8782552083333,74.02955118815105,1092.2906901041667,70.07086690266927,1088.703125,66.1121826171875 C1084.2495930989583,63.266886393229164,1079.7960611979167,60.421590169270836,1075.342529296875,57.5762939453125 L1060.4974365234375,51.26713562011719
M937.6546630859375,57.947418212890625 C934.9330647786459,59.555633544921875,932.2114664713541,61.163848876953125,929.4898681640625,62.772064208984375 C927.0157063802084,65.12252807617188,924.5415445963541,67.47299194335938,922.0673828125,69.82345581054688 C919.2220662434896,74.40068054199219,916.3767496744791,78.9779052734375,913.5314331054688,83.55513000488281 C912.0469360351562,89.86427815755208,910.5624389648438,96.17342631022136,909.0779418945312,102.48257446289062 C909.0779418945312,107.43092854817708,909.0779418945312,112.37928263346355,909.0779418945312,117.32763671875 C911.7995198567709,112.13186645507812,914.5210978190104,106.93609619140625,917.24267578125,101.74032592773438 C920.9539388020834,97.28680928548177,924.6652018229166,92.83329264322917,928.37646484375,88.37977600097656 C933.6959635416666,84.54480489095052,939.0154622395834,80.70983378092448,944.3349609375,76.87486267089844 C948.9121907552084,75.26664733886719,953.4894205729166,73.65843200683594,958.066650390625,72.05021667480469 C964.3757731119791,72.91617838541667,970.6848958333334,73.78214009602864,976.9940185546875,74.64810180664062 C983.5505981445312,78.35936482747395,990.107177734375,82.0706278483073,996.6637573242188,85.78189086914062 C1000.4987386067709,89.86427815755208,1004.3337198893229,93.94666544596355,1008.168701171875,98.029052734375 C1010.7665608723959,104.4619140625,1013.3644205729166,110.894775390625,1015.9622802734375,117.32763671875 C1015.8385823567709,111.63702392578125,1015.7148844401041,105.9464111328125,1015.5911865234375,100.25579833984375 C1013.8592529296875,94.19407145182292,1012.1273193359375,88.13234456380208,1010.3953857421875,82.07061767578125 Q1008.910888671875,79.28717041015625,1007.4263916015625,76.50372314453125 C1003.0965983072916,72.29762776692708,998.7668050130209,68.09153238932292,994.43701171875,63.88543701171875 C989.1175130208334,61.53496805826823,983.7980143229166,59.18449910481771,978.478515625,56.83403015136719 C972.91162109375,55.72065226236979,967.3447265625,54.6072743733724,961.77783203125,53.493896484375 C956.2109375,53.865020751953125,950.64404296875,54.23614501953125,945.0771484375,54.607269287109375 L931.3455200195312,59.431915283203125
M778.5307006835938,57.5762939453125 C776.5513509114584,59.18450419108073,774.5720011393229,60.79271443684896,772.5926513671875,62.40092468261719 C771.108154296875,65.24622599283855,769.6236572265625,68.09152730305989,768.13916015625,70.93682861328125 C766.7783610026041,75.14292907714844,765.4175618489584,79.34902954101562,764.0567626953125,83.55513000488281 C763.6856282552084,86.52413940429688,763.3144938151041,89.49314880371094,762.943359375,92.462158203125 C763.1907958984375,97.28680419921875,763.438232421875,102.1114501953125,763.6856689453125,106.93609619140625 C764.4279174804688,110.02880859375,765.170166015625,113.12152099609375,765.9124145507812,116.2142333984375 C768.8814290364584,120.79146321614583,771.8504435221354,125.36869303385417,774.8194580078125,129.9459228515625 C778.6544189453125,132.66752115885416,782.4893798828125,135.38911946614584,786.3243408203125,138.1107177734375 C791.3964029947916,140.461181640625,796.4684651692709,142.8116455078125,801.54052734375,145.162109375 C806.4888916015625,146.3991902669271,811.437255859375,147.63627115885416,816.3856201171875,148.87335205078125 C819.7257486979166,149.12076822916666,823.0658772786459,149.3681844075521,826.406005859375,149.6156005859375 C829.9935709635416,148.9970703125,833.5811360677084,148.3785400390625,837.168701171875,147.760009765625 C839.8902791341146,146.6466267903646,842.6118570963541,145.53324381510416,845.3334350585938,144.41986083984375 C852.3848470052084,139.3477986653646,859.4362589518229,134.2757364908854,866.4876708984375,129.20367431640625 C854.1167805989584,131.18301391601562,841.7458902994791,133.162353515625,829.375,135.14169311523438 C825.9111531575521,135.14169311523438,822.4473063151041,135.14169311523438,818.9834594726562,135.14169311523438 C814.9010823567709,134.15201822916666,810.8187052408854,133.16234334309897,806.736328125,132.17266845703125 C802.6539306640625,129.69849650065103,798.571533203125,127.22432454427083,794.4891357421875,124.75015258789062 C791.3964029947916,120.79147338867188,788.3036702473959,116.83279418945312,785.2109375,112.87411499023438 C781.9945068359375,103.59595743815105,778.778076171875,94.3177998860677,775.5616455078125,85.03964233398438 C775.5616455078125,78.60678100585938,775.5616455078125,72.17391967773438,775.5616455078125,65.74105834960938 L780.0151977539062,49.782623291015625
M621.9857177734375,63.1431884765625 Q624.0269165039062,60.730865478515625,626.068115234375,58.31854248046875 C630.5216267903646,55.72065734863281,634.9751383463541,53.122772216796875,639.4286499023438,50.52488708496094 C644.6244099934896,49.164093017578125,649.8201700846354,47.80329895019531,655.0159301757812,46.4425048828125 C658.6034952799479,46.4425048828125,662.1910603841146,46.4425048828125,665.7786254882812,46.4425048828125 C669.4898885091146,47.30846150716146,673.2011515299479,48.174418131510414,676.9124145507812,49.040374755859375 C683.840087890625,53.24647521972656,690.7677612304688,57.45257568359375,697.6954345703125,61.65867614746094 C699.4273681640625,63.3905995686849,701.1593017578125,65.12252298990886,702.8912353515625,66.85444641113281 C704.9943033854166,70.31829325358073,707.0973714192709,73.78214009602864,709.200439453125,77.24598693847656 C711.1797688802084,81.69950358072917,713.1590983072916,86.15302022298177,715.138427734375,90.60653686523438 C715.7569580078125,93.328125,716.37548828125,96.04971313476562,716.9940185546875,98.77130126953125 C716.8703206380209,102.48256429036458,716.7466227213541,106.19382731119792,716.6229248046875,109.90509033203125 C715.3858235677084,114.6060282389323,714.1487223307291,119.30696614583333,712.91162109375,124.00790405273438 C709.942626953125,128.46142578125,706.9736328125,132.91494750976562,704.004638671875,137.36846923828125 C700.169677734375,140.83231608072916,696.334716796875,144.2961629231771,692.499755859375,147.760009765625 C695.2213338216146,139.84264119466147,697.9429117838541,131.9252726236979,700.6644897460938,124.00790405273438 C700.7882080078125,120.17293294270833,700.9119262695312,116.3379618326823,701.03564453125,112.50299072265625 C699.4274088541666,107.05980428059895,697.8191731770834,101.61661783854167,696.2109375,96.17343139648438 C693.8604736328125,92.58587646484375,691.510009765625,88.99832153320312,689.1595458984375,85.4107666015625 C686.3142496744791,82.3180440266927,683.4689534505209,79.22532145182292,680.6236572265625,76.13259887695312 C675.5515950520834,73.03988138834636,670.4795328776041,69.94716389973958,665.407470703125,66.85444641113281 C659.9642944335938,65.12252298990886,654.5211181640625,63.3905995686849,649.0779418945312,61.65867614746094 C643.2636311848959,61.040130615234375,637.4493204752604,60.42158508300781,631.635009765625,59.80303955078125 L619.3878173828125,62.02980041503906
M499.21173095703125,46.07136535644531 C502.42816162109375,45.57652791341146,505.64459228515625,45.0816904703776,508.86102294921875,44.58685302734375 C512.5722859700521,44.9579823811849,516.2835489908854,45.32911173502604,519.9948120117188,45.70024108886719 C526.303955078125,48.298126220703125,532.6130981445312,50.89601135253906,538.9222412109375,53.493896484375 C541.5201212565104,55.473236083984375,544.1180013020834,57.45257568359375,546.7158813476562,59.431915283203125 C548.9426472981771,62.40092976888021,551.1694132486979,65.3699442545573,553.3961791992188,68.33895874023438 C555.1280924479166,72.54505411783855,556.8600056966146,76.7511494954427,558.5919189453125,80.95724487304688 C559.5815836588541,86.7715555826823,560.5712483723959,92.5858662923177,561.5609130859375,98.40017700195312 C561.6846313476562,102.85369873046875,561.808349609375,107.30722045898438,561.9320678710938,111.7607421875 C561.3135172526041,114.72975667317708,560.6949666341146,117.69877115885417,560.076416015625,120.66778564453125 C558.5919189453125,123.26566569010417,557.107421875,125.86354573567708,555.6229248046875,128.46142578125 C550.4271647135416,132.42010498046875,545.2314046223959,136.3787841796875,540.03564453125,140.33746337890625 C534.0976155598959,142.8116455078125,528.1595865885416,145.28582763671875,522.2215576171875,147.760009765625 C513.1908162434896,148.87338256835938,504.1600748697917,149.98675537109375,495.12933349609375,151.10012817382812 Q494.5726318359375,150.54344177246094,494.01593017578125,149.98675537109375 Q494.7582092285156,149.2445068359375,495.50048828125,148.50225830078125 C500.3251139322917,145.28582763671875,505.1497395833333,142.06939697265625,509.974365234375,138.85296630859375 C514.1804606119791,134.39944458007812,518.3865559895834,129.9459228515625,522.5926513671875,125.49240112304688 C524.943115234375,121.41001383463542,527.2935791015625,117.32762654622395,529.64404296875,113.2452392578125 C530.510009765625,109.03914388020833,531.3759765625,104.83304850260417,532.241943359375,100.626953125 C531.2522786458334,94.194091796875,530.2626139322916,87.76123046875,529.27294921875,81.328369140625 C526.5513509114584,75.8851826985677,523.8297526041666,70.44199625651042,521.108154296875,64.99880981445312 C517.7680257161459,61.28754679361979,514.4278971354166,57.57628377278646,511.0877685546875,53.865020751953125 L501.0673828125,46.813629150390625
M363.1285705566406,50.15374755859375 C360.406982421875,52.50422159830729,357.6853942871094,54.854695638020836,354.96380615234375,57.205169677734375 C353.10817464192706,60.66901143391927,351.25254313151044,64.13285319010417,349.39691162109375,67.59669494628906 C347.17014567057294,76.00889078776042,344.94337972005206,84.42108662923177,342.71661376953125,92.83328247070312 Q342.71661376953125,97.28680419921875,342.71661376953125,101.74032592773438 C343.706298828125,105.57529703776042,344.69598388671875,109.41026814778645,345.6856689453125,113.2452392578125 C348.0361328125,116.83279418945312,350.3865966796875,120.42034912109375,352.737060546875,124.00790405273438 C354.9638163248698,126.23465983072917,357.19057210286456,128.46141560872397,359.4173278808594,130.68817138671875 C365.10793050130206,134.02831013997397,370.7985331217448,137.36844889322916,376.4891357421875,140.70858764648438 C382.4271545410156,142.1930948893229,388.36517333984375,143.67760213216147,394.3031921386719,145.162109375 Q399.1278381347656,145.162109375,403.9524841308594,145.162109375 C409.64308675130206,143.43018595377603,415.3336893717448,141.6982625325521,421.0242919921875,139.96633911132812 C428.8179423014323,134.64686075846353,436.61159261067706,129.32738240559897,444.4052429199219,124.00790405273438 C438.34351603190106,125.98724365234375,432.2817891438802,127.96658325195312,426.2200622558594,129.9459228515625 C417.3130289713542,130.5644734700521,408.40599568684894,131.18302408854166,399.49896240234375,131.80157470703125 C394.42690022786456,130.5644734700521,389.35483805338544,129.3273722330729,384.28277587890625,128.09027099609375 C379.45814005533856,124.99755859375,374.6335042317708,121.90484619140625,369.8088684082031,118.8121337890625 C365.3553466796875,113.3689473470052,360.9018249511719,107.92576090494792,356.44830322265625,102.48257446289062 C355.2112223307292,97.28680419921875,353.97414143880206,92.09103393554688,352.737060546875,86.895263671875 C353.7267252604167,80.33869934082031,354.7163899739583,73.78213500976562,355.7060546875,67.22557067871094 C356.572021484375,64.5039774576823,357.43798828125,61.78238423665365,358.303955078125,59.060791015625 L364.61309814453125,48.298126220703125
M214.80960083007812,40.8756103515625 C208.12932840983072,45.5765380859375,201.44905598958334,50.2774658203125,194.76878356933594,54.9783935546875 C192.54202270507812,57.699991861979164,190.3152618408203,60.421590169270836,188.0885009765625,63.1431884765625 C185.738037109375,67.59670003255208,183.3875732421875,72.05021158854167,181.037109375,76.50372314453125 C180.29485575358072,79.47273763020833,179.55260213216147,82.44175211588542,178.8103485107422,85.4107666015625 C178.8103485107422,88.75089518229167,178.8103485107422,92.09102376302083,178.8103485107422,95.43115234375 C180.78968811035156,102.72998046875,182.76902770996094,110.02880859375,184.7483673095703,117.32763671875 C187.09883626302084,121.28631591796875,189.44930521647134,125.2449951171875,191.79977416992188,129.20367431640625 C193.90282185872397,131.55413818359375,196.00586954752603,133.90460205078125,198.10891723632812,136.25506591796875 C203.42839558919272,139.47149658203125,208.74787394205728,142.68792724609375,214.06735229492188,145.90435791015625 C220.37650044759116,147.2651570638021,226.6856486002604,148.6259562174479,232.9947967529297,149.98675537109375 C238.31427001953125,149.98675537109375,243.6337432861328,149.98675537109375,248.95321655273438,149.98675537109375 C254.02527872721353,148.50224812825522,259.0973409016927,147.01774088541666,264.1694030761719,145.53323364257812 Q267.13841247558594,143.86317443847656,270.107421875,142.193115234375 C273.3238525390625,138.9766845703125,276.540283203125,135.76025390625,279.7567138671875,132.5438232421875 C282.72572835286456,127.96659342447917,285.6947428385417,123.38936360677083,288.66375732421875,118.8121337890625 C289.7771301269531,114.48232014973958,290.8905029296875,110.15250651041667,292.0038757324219,105.82269287109375 C292.2512919108073,102.11142985026042,292.4987080891927,98.40016682942708,292.7461242675781,94.68890380859375 C290.89049275716144,88.00863647460938,289.0348612467448,81.328369140625,287.1792297363281,74.64810180664062 C283.2205505371094,69.08120727539062,279.2618713378906,63.514312744140625,275.3031921386719,57.947418212890625 C269.6125895182292,54.112447102864586,263.92198689778644,50.27747599283854,258.23138427734375,46.4425048828125 C253.77787272135416,45.205413818359375,249.3243611653646,43.96832275390625,244.870849609375,42.731231689453125 L215.92298889160156,41.246734619140625
M87.58656311035156,46.4425048828125 C81.89596048990886,51.1434326171875,76.20535786946614,55.8443603515625,70.51475524902344,60.5452880859375 C67.29832458496094,65.98847961425781,64.08189392089844,71.43167114257812,60.86546325683594,76.87486267089844 C59.257250467936196,82.44176228841145,57.64903767903646,88.00866190592448,56.04082489013672,93.5755615234375 Q56.04082489013672,97.843505859375,56.04082489013672,102.1114501953125 C57.030494689941406,106.19383748372395,58.020164489746094,110.27622477213542,59.00983428955078,114.35861206054688 C61.36030069986979,118.93583170572917,63.710767110188804,123.51305135091145,66.06123352050781,128.09027099609375 C71.75183614095052,133.40974934895834,77.44243876139323,138.7292277018229,83.13304138183594,144.0487060546875 C89.93702697753906,146.89401245117188,96.74101257324219,149.73931884765625,103.54499816894531,152.58462524414062 C111.21494547526042,152.4609171549479,118.88489278157552,152.33720906575522,126.55484008789062,152.2135009765625 C118.88489278157552,148.25482177734375,111.21494547526042,144.296142578125,103.54499816894531,140.33746337890625 C98.72035471598308,135.7602335611979,93.89571126302083,131.1830037434896,89.0710678100586,126.60577392578125 C86.8443094889323,122.15226236979167,84.61755116780598,117.69875081380208,82.39079284667969,113.2452392578125 C81.5248311360677,106.93609619140625,80.65886942545573,100.626953125,79.79290771484375,94.31781005859375 C81.02999623616536,88.99832661946614,82.26708475748698,83.67884318033855,83.5041732788086,78.35935974121094 C86.47318522135417,73.65842692057292,89.44219716389973,68.95749409993489,92.41120910644531,64.25656127929688 C98.8440653483073,57.9474131266276,105.27692159016927,51.638264973958336,111.70977783203125,45.32911682128906 C114.80250040690105,43.4734853108724,117.89522298177083,41.61785380045573,120.98794555664062,39.76222229003906 Q124.51364135742188,38.83440399169922,128.03933715820312,37.906585693359375 C118.63746897379558,39.391092936197914,109.23560078938802,40.87560017903646,99.83373260498047,42.360107421875 C96.74101257324219,43.34977722167969,93.6482925415039,44.339447021484375,90.55557250976562,45.32911682128906 L81.27742004394531,50.52488708496094
M1275.2572021484375,251.79376220703125 L1275.2572021484375,227.96029663085938 L1274.3404541015625,223.376953125 L1274.3404541015625,219.71026611328125 L1274.3404541015625,216.0435791015625 L1275.2572021484375,203.21017456054688 L1275.2572021484375,182.126708984375" fill="hsl(200, 100%, 50%)" style="display:none;" />
    </svg>

    <script>
        const fileInput = document.getElementById('audioFile');
        const audioPlayer = document.getElementById('audioPlayer');
        const shapeSelect = document.getElementById('shapeSelect');
        const svgVisualizer = document.getElementById('svgVisualizer');
        const shapes = {
            circle: document.getElementById('circle'),
            heart: document.getElementById('heart'),
            crescent: document.getElementById('crescent'),
            waning: document.getElementById('waning')
        };

        let audioContext, analyser, source, frequencyData;
        let animationFrameId;

        fileInput.addEventListener('change', handleFileUpload);
        shapeSelect.addEventListener('change', updateShapeVisibility);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('audio/')) {
                const audioURL = URL.createObjectURL(file);
                audioPlayer.src = audioURL;
                audioPlayer.load();
                initAudio(audioURL);
            } else {
                alert('Please upload a valid audio file.');
            }
        }

        function initAudio(audioURL) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            frequencyData = new Uint8Array(bufferLength);

            source = audioContext.createMediaElementSource(audioPlayer);
            source.connect(analyser);
            analyser.connect(audioContext.destination);

            visualize();
        }

        function visualize() {
            animationFrameId = requestAnimationFrame(visualize);
            analyser.getByteFrequencyData(frequencyData);

            const averageFrequency = frequencyData.reduce((a, b) => a + b) / frequencyData.length;
            const scale = 0.5 + (averageFrequency / 255) * 1.5; // Scale between 0.5 and 2
            const hue = Math.round((averageFrequency / 255) * 360);

            const selectedShape = shapes[shapeSelect.value];
            selectedShape.setAttribute('fill', `hsl(${hue}, 100%, 50%)`);

            if (shapeSelect.value === 'circle') {
                selectedShape.setAttribute('r', 25 * scale);
            } else {
                selectedShape.setAttribute('transform', `scale(${scale}) translate(${50 - 50 * scale}, ${50 - 50 * scale})`);
            }
        }

        function updateShapeVisibility() {
            Object.values(shapes).forEach(shape => shape.style.display = 'none');
            shapes[shapeSelect.value].style.display = 'block';
        }

        audioPlayer.addEventListener('play', () => {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
        });
    </script>
</body>
</html>
